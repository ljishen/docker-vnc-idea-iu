#!/usr/bin/env bash

set -eu

PLATFORM_FOLDER=.$(grep -oP 'idea.paths.selector=\K[\w\.\d]+' "$HOME"/ideaUI/bin/idea.sh)

mkdir -p \
    "$HOME"/"$PLATFORM_FOLDER" \
    "$HOME"/.gradle \
    "$HOME"/.m2 \
    "$HOME"/.java \
    "$HOME"/IdeaProjects

docker run --rm \
       --user "$(id -u)":"$(id -g)" \
       -v "$HOME"/ideaUI:/headless/ideaUI \
       -v "$HOME"/"$PLATFORM_FOLDER":/headless/"$PLATFORM_FOLDER" \
       -v "$HOME"/.gradle:/headless/.gradle \
       -v "$HOME"/.m2:/headless/.m2 \
       -v "$HOME"/.java:/headless/.java \
       -v "$HOME"/IdeaProjects:/headless/IdeaProjects \
       -p 5901:5901 \
       -p 6901:6901 \
       ljishen/docker-vnc-ideaui
